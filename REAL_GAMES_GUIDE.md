# Руководство по использованию функциональности реальных игр

## Обзор

Новая функциональность позволяет обрабатывать реальные игры из input файлов и генерировать actual файлы с результатами применения стратегий. Это особенно полезно для анализа реальных сценариев и отслеживания эффективности стратегий на исторических данных.

## Основные возможности

1. **Обработка input файлов**: Чтение файлов с результатами и коэффициентами
2. **Генерация actual файлов**: Создание файлов с расчетными ставками и результатами
3. **Фильтрация по флагам**: Обработка файлов только с определенными флагами
4. **Сравнение количества строк**: Автоматическое определение необходимости обновления
5. **Валидация флагов**: Проверка зарегистрированных флагов

## Использование

### Базовое использование

```bash
# Обработка всех файлов в папке real-games
go run cmd/trainer/main.go -real -strategy xlDrop

# С отладочным выводом
go run cmd/trainer/main.go -real -debug -strategy xlDrop
```

### Фильтрация по флагам

```bash
# Обрабатывать только файлы с флагом TEST
go run cmd/trainer/main.go -real -TEST -strategy xlDrop

# Обрабатывать только файлы с флагом PROD
go run cmd/trainer/main.go -real -PROD -strategy xlDrop

# Обрабатывать файлы с несколькими флагами
go run cmd/trainer/main.go -real -TEST -PROD -strategy xlDrop
```

## Формат файлов

### Input файлы

Файлы с расширением `.input` должны содержать данные в формате CSV:

```csv
result,oddF,oddX,oddL
X,2.0,3.5,4.0
F,1.9,3.3,4.1
L,1.85,3.6,4.4
```

#### Флаги в именах файлов

Имена файлов могут содержать флаги для фильтрации:
- `test-TEST.input` - файл с флагом TEST
- `production-PROD.input` - файл с флагом PROD
- `simple.input` - файл без флага

### Actual файлы

Файлы с расширением `.actual` генерируются автоматически и содержат полные результаты:

```csv
event_number,result,oddF,oddX,oddL,betF,betX,betL,lossF,lossX,lossL,total,uf,ux,ul,pattern
1,X,2.00,3.50,4.00,10000,4000,3350,20000,0,13350,10000,1,0,1,
2,F,1.90,3.30,4.10,11150,6150,6250,0,20200,25550,20000,0,1,2,
3,L,1.85,3.60,4.40,11800,6850,8250,21800,24600,0,30000,1,2,0,
```

## Зарегистрированные флаги

По умолчанию зарегистрированы следующие флаги:
- `TEST` - для тестовых файлов
- `PROD` - для production файлов
- `STAGING` - для staging файлов

### Регистрация новых флагов

Для добавления нового флага, добавьте его в функцию `init()` в `cmd/trainer/main.go`:

```go
func init() {
    trainer.RegisterFlag("TEST")
    trainer.RegisterFlag("PROD")
    trainer.RegisterFlag("STAGING")
    trainer.RegisterFlag("NEWFLAG")  // Новый флаг
}
```

## Логика обработки

### 1. Проверка папки real-games

- Если папка не существует, она создается автоматически
- Если папка пуста, выводится соответствующее сообщение

### 2. Фильтрация файлов

- Файлы с незарегистрированными флагами вызывают ошибку
- При указании активных флагов обрабатываются только файлы с этими флагами
- Файлы без флагов обрабатываются только когда нет активных флагов

### 3. Сравнение количества строк

- Если actual файл существует и количество строк совпадает с input, файл не обновляется
- Это позволяет избежать повторной обработки неизмененных файлов

### 4. Генерация результатов

- Input файл читается с помощью `ReadInputCSV`
- Применяется указанная стратегия
- Результаты сохраняются в actual файл

## Примеры использования

### Пример 1: Базовая обработка

```bash
# Создаем input файл
echo "result,oddF,oddX,oddL" > real-games/match.input
echo "X,2.0,3.5,4.0" >> real-games/match.input
echo "F,1.9,3.3,4.1" >> real-games/match.input

# Обрабатываем
go run cmd/trainer/main.go -real -strategy xlDrop

# Результат: создан файл real-games/match.actual
```

### Пример 2: Фильтрация по флагам

```bash
# Создаем файлы с разными флагами
echo "result,oddF,oddX,oddL" > real-games/test-TEST.input
echo "X,2.0,3.5,4.0" >> real-games/test-TEST.input

echo "result,oddF,oddX,oddL" > real-games/production-PROD.input
echo "F,1.9,3.3,4.1" >> real-games/production-PROD.input

# Обрабатываем только TEST файлы
go run cmd/trainer/main.go -real -TEST -strategy xlDrop

# Результат: обработан только test-TEST.input
```

### Пример 3: Обновление файлов

```bash
# Изменяем input файл
echo "result,oddF,oddX,oddL" > real-games/match.input
echo "X,2.0,3.5,4.0" >> real-games/match.input
echo "F,1.9,3.3,4.1" >> real-games/match.input
echo "L,1.85,3.6,4.4" >> real-games/match.input  # Новая строка

# Обрабатываем
go run cmd/trainer/main.go -real -strategy xlDrop

# Результат: match.actual обновлен (количество строк изменилось)
```

## Обработка ошибок

### Незарегистрированные флаги

```
Ошибка: флаг 'UNKNOWN' в файле test-UNKNOWN.input не зарегистрирован
Зарегистрированные флаги: [STAGING TEST PROD]
exit status 1
```

### Неверный формат CSV

```
Ошибка чтения файла test.input: invalid CSV format at row 1: expected at least 4 columns, got 3
```

## Отладка

Используйте флаг `-debug` для получения подробной информации о процессе обработки:

```bash
go run cmd/trainer/main.go -real -debug -strategy xlDrop
```

Вывод включает:
- Найденные файлы
- Флаги файлов
- Процесс фильтрации
- Детали расчета стратегии

## Интеграция с рабочим процессом

### Автоматизация

Можно создать скрипт для автоматической обработки:

```bash
#!/bin/bash
# process_real_games.sh

cd /path/to/go-trainer
go run cmd/trainer/main.go -real -strategy xlDrop -verbose
```

### Планировщик

Добавить в cron для ежедневной обработки:

```bash
# Ежедневная обработка в 9:00
0 9 * * * cd /path/to/go-trainer && go run cmd/trainer/main.go -real -strategy xlDrop
```

## Лучшие практики

1. **Используйте флаги** для организации файлов по средам (TEST, PROD, STAGING)
2. **Проверяйте результаты** после каждого обновления input файлов
3. **Используйте отладку** при возникновении проблем
4. **Резервируйте данные** перед массовыми обновлениями
5. **Документируйте изменения** в input файлах для отслеживания

## Ограничения

1. Input файлы должны содержать минимум 4 колонки (result, oddF, oddX, oddL)
2. Флаги должны быть зарегистрированы перед использованием
3. Количество строк в input и actual файлах должно совпадать для пропуска обработки
4. Папка real-games должна находиться в корневой директории проекта